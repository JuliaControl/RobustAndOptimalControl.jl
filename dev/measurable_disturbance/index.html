<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>H_2 design with a known disturbance · RobustAndOptimalControl Documentation</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">RobustAndOptimalControl Documentation</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../uncertainty/">Uncertainty modeling</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../hinf_DC/">Simple mixed-sensitivity <span>$H_\infty$</span> design</a></li><li><a class="tocitem" href="../hinf_connection/">General <span>$H_\infty$</span> design</a></li><li><a class="tocitem" href="../lqg_disturbance/">LQG control with integral action</a></li><li><a class="tocitem" href="../cartpole/">Control design for a pendulum on a cart</a></li><li class="is-active"><a class="tocitem" href><span>$H_2$</span> design with a known disturbance</a></li></ul></li><li><a class="tocitem" href="../api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href><span>$H_2$</span> design with a known disturbance</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href><span>$H_2$</span> design with a known disturbance</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/JuliaControl/RobustAndOptimalControl.jl/blob/master/docs/src/measurable_disturbance.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Feedforward-from-known-disturbances"><a class="docs-heading-anchor" href="#Feedforward-from-known-disturbances">Feedforward from known disturbances</a><a id="Feedforward-from-known-disturbances-1"></a><a class="docs-heading-anchor-permalink" href="#Feedforward-from-known-disturbances" title="Permalink"></a></h1><p>This example will demonstrate how you can make use of a known/measurable disturbance and achieve effective disturbance rejection using an <span>$\mathcal{H}_2$</span> controller. For simplicity, we will consider a simple first-order system <span>$G$</span></p><p class="math-container">\[\begin{aligned}
\dot{x} &amp;= -ax + b(u + d) \\
y_x &amp;= cx + e_y \\
y_d &amp;= d + e_d
\end{aligned}\]</p><p>where a load disturbance <span>$d$</span> is acting on the input of the system. We have access to a measurement <span>$y_x$</span> of the state and a measurement <span>$y_d$</span> of the disturbance. Both of them are assumed corrupted by measurement noise (this fact is crucial, if there is no measurement noise on the disturbance measurement, the controller will ignore the measurement of the state).</p><p>We start by defining the process model.</p><pre><code class="language- hljs">using RobustAndOptimalControl, ControlSystemsBase, Plots, LinearAlgebra
G = ss(tf(1, [10, 1])) # Process model</code></pre><p>We then choose the parameters of the <span>$\mathcal{H}_2$</span> controller, i.e., noise variances and how much we penalize state and inputs. When tuning a <span>$\mathcal{H}_2$</span> controller, we do not choose matrices in quite the same way as when we tune an LQG controller, but an LQG controller is actually a <span>$\mathcal{H}_2$</span> in disguise, see sec. 9.3.3 in Skogestad for more details. </p><p>We will partition the system according to</p><p class="math-container">\[\begin{bmatrix}
\dot x \\ \hline z_y \\ z_u \\ \hline y_x \\ y_d
\end{bmatrix}=
\begin{bmatrix}
A   &amp; B_d &amp; 0 &amp; 0 &amp; B_u \\ \hline
C_z &amp; 0   &amp; 0 &amp; 0 &amp; 0   \\
0   &amp; 0   &amp; 0 &amp; 0 &amp; r   \\ \hline
C   &amp; 0   &amp; 1 &amp; 0 &amp; 0   \\
0   &amp; 1   &amp; 0 &amp; 1 &amp; 0   \\
\end{bmatrix}
\begin{bmatrix}
x \\ \hline d \\ e_y \\ e_d \\ \hline u
\end{bmatrix}\]</p><p>where <span>$C_z = qC$</span> and <span>$B_d = w_d B$</span>.</p><pre><code class="language- hljs">σye = 1  # standard deviation of output measurement
σyd = 10 # standard deviation of known-disturbance measurement
wd = 100 # Disturbance suppression weight

q = 10   # Penalty on output
r = 0.1  # Penalty on input

Ge = ExtendedStateSpace(G,
    B1 = [wd*G.B 0 0],        # Load disturbance, y measurement noise, d measurement noise
    C1 = [q*G.C; 0G.C],    # Q1 = C1&#39;C1
    C2 = [G.C; 0G.C],      # Measure output and load disturbance, load disturbance is not a function of state
    D12 = [0; r],              # Penalize control action Q2 = D12&#39;D12
    D21 = [0 σye 0; 1 0 σyd],  # direct feedthrough of load disturbance and measurement noise
)

h2 = false
if h2
    K, Cl = h2synthesize(Ge, 100)
else
    K, γ, mats = hinfsynthesize(Ge)
    Cl = lft(Ge, K)
end</code></pre><pre><code class="language- hljs">x0  = zeros(G.nx) # Initial condition
disturbance = (x, t) -&gt; [10 &lt; t * Ts &lt; 20; 0randn(); 0randn()] # This is our load disturbance, a step at ``t = 10``

res = lsim(Cl, disturbance, 100, dt=0.001, adaptive=false)
plot(res)</code></pre><p>Before we feel confident about deploying the LQG controller, we investigate its closed-loop properties. The (negative) feedback controller is given by <code>-K[1,1]</code> (the - sign since <a href="../api/#RobustAndOptimalControl.h2synthesize"><code>h2synthesize</code></a> returns a positive-feedback controller).</p><pre><code class="language- hljs">w = exp10.(LinRange(-3, 4, 300))
gangoffourplot(G, -K[1,1], w, lab = &quot;&quot;, legend = :bottomright)</code></pre><p>We see that our design led to a system with reasonable disturbance-rejection properties, however, since we assume that we can measure the disturbance, it&#39;s relevant to also consider the transfer function from this disturbance to the output.</p><p>This transfer function is given by <code>Cl[1,1]</code> and has been scaled by the disturbance-suppression weight <span>$w_d$</span> and the performance penalty weight <span>$q$</span>, so we rescale it to get back the original units.</p><pre><code class="language- hljs">bodeplot!((1/q/wd)Cl[1,1], w, plotphase=false, sp=2, lab=&quot;Gyd&quot;, l=:dash)</code></pre><p>we see that it overlaps completely with the classical sensitivity function <code>PS</code>, which is expected.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../cartpole/">« Control design for a pendulum on a cart</a><a class="docs-footer-nextpage" href="../api/">API »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.23 on <span class="colophon-date" title="Sunday 11 September 2022 15:35">Sunday 11 September 2022</span>. Using Julia version 1.7.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
